### Database 정규화



- 정규화를 하는 이유? `갱신이상` 현상을 방지하기 위해
- 3가지 갱신이상 현상
- 정규화란?
  - 구조가 나쁜 릴레이션을 좋은 구조의 릴레이션으로 만들어가는 과정.
  - 나쁜 구조의 릴레이션은 데이터가 중복되어 저장되어 갱신 이상이 발생할 가능성이 높다.
- 나쁜 릴레이션을 판단하는 방법은?
  - 엔티티를 구성하고 있는 애트리뷰트들 간에 함수적 종속성이 있는지를 판단한다. 이때 도출된 함수적 종속성은 설계 시에 정형적 기준으로 적용된다.
- 함수적 종속성이란?
  - 

<br>



### 참고자료

- [https://github.com/Agugu95/Interview_Question_for_Beginner/tree/master/Database](https://github.com/Agugu95/Interview_Question_for_Beginner/tree/master/Database)

<br>



### 정규화를 하는 이유 ? `갱신 이상` 현상을 방지하기 위해

정규화를 제대로 거치지 않으면 갱신 이상 현상이 발생한다.<br>

정규화는 어떤 배경에서 생겼을까? 한 릴레이션에 여러 엔티티의 애트리뷰트들을 혼합하면 정보가 중복저장되는 현상이 발생한다. 결과적으로는 이렇게 중복저장되는 현상으로 인해 갱신이 이상 현상이 발생한다. 또한 저장공간을 낭비하게 된다는 단점이 있다.<br>

예를 들면, 하나의 테이블에 컬럼을 너무 많이 둘 경우 원하지 않는 데이터가 중복저장되는 현상이 발생한다. 이런 경우에는 대표적으로 아래와 같은 현상들이 발생한다.<br>

- 삽입 이상 (INSERTION ANOMALIES)
  - 원하지 않는 컬럼에 대한 데이터도 함께 INSERT 해줘야 하거나, INSERT 시 입력한 컬럼을 맞추지 못해 INSERT 하지 못하는 현상
- 삭제 이상 (DELETION ANOMALIES)
  - 어떤 조건에 해당되는 데이터를 삭제하려고 하는데 이 행에 묶여있는 다른 컬럼들도 함께 삭제되는 현상
- 수정(갱신) 이상 (MODIFICATION ANOMALIES)
  - 중복되는 컬럼이 많아서 정확하지 않거나 일부의 튜플만 갱신되어 정보가 모호해지고 일관성이 없어져서 일관성이 없어지는 현상

<br>



### 3가지 갱신이상 현상들

갱신 이상 증상은 아래의 3가지 종류들이 잇다.

- 삽입 이상 (INSERTION ANOMALIES)
  - 원하지 않는 자료가 삽입되거나 삽입하는데 자료가 부족해서 삽입이 되지 않는 현상
- 삭제 이상 (DELETION ANOMALIES)
  - 하나의 자료만 삭제하고자 하지만 그 자료가 포함된 튜플 전체가 삭제되는 현상.
- 수정(갱신) 이상 (MODIFICATION ANOMALIES)
  - 정확하지 않거나 일부의 튜플만 갱신되어 정보가 모호해지거나 일관성이 없어지는 현상. 

<br>



### 정규화란?

관계형 데이터베이스에서 중복을 최소화하기 위해 6단계의 정규화를 거치면서 구조화를 거치는 작업.

구조가 나쁜 릴레이션들을 좋은 구조의 릴레이션으로 분해해나가는 과정이다. 정규화 작업을 거치면 최종적으로 정규형을 만족하게 된다.

<br>



### 나쁜 릴레이션을 판단하는 방법은?

엔티티를 구성하고 있는 애트리뷰트들 간에 함수적 종속성이 있는지를 판단한다. 이때 도출된 함수적 종속성은 설계 시에 정형적 기준으로 적용된다.

<br>



### 함수적 종속성이란 무엇인가?

애트리뷰트의 데이터의 의미를 보고, 애트리뷰트들 간에 서로 종속성이 있는 관계가 있는지 등을 의미한다.<br>

비지니스 요건을 통해서 어떤 속성이 다른 속성을 유일(Unique)하게 결정짓는 경우 이런 경우 "X는 Y를 함수적으로 결정한다"라고 한다.<br>



e.g. 

- 애트리뷰트 들 중에 X,Y 가 있다고 해보자. 이때 X의 값이 변하는 것에 따라 Y의 값을 유일하게(unique) 변경하거나 결정짓는다면
- 이것을 <u>"X는 Y를 함수적으로 결정한다"</u> 라고 한다.

<br>



각각의 정규형은 어떤 조건을 만족해야 할까?

- 분해의 대상인 분해집합 D 는 무손실 조인을 보장해야 한다.
- 분해집합 D는 함수적 종속성을 보존해야 한다.

<br>



### 정규형

각 정규형은 그 선행 정규행보다 더 엄격한 조건을 갖는다.

- 모든 제 2 정규형 릴레이션은 제 1 정규형을 갖는다.
- 모든 제 3 정규형 릴레이션은 제 2 정규형을 갖는다.
- 모든 BCNF 정규형 릴레이션은 제 3 정규형을 갖는다.

<br>



### 제 1 정규형 (x,y)

더 이상 쪼갤 수 없는 원자값 수준으로 분류한 단계.



> 아래 내용은 수정필요(soon.good 리포지터리 백업 확인 후 인프런 강의 내용 필기를 참조해 수정 필요)

애트리뷰트의 도메인이 오직 원자값 만을 포함하고, 튜플의 모든 애트리뷰트가 도메인에 속하는 하나의 값을 가져야 한다.<br>

복합 애트리뷰트, 다중 값 애트리뷰트, 중첩 릴레이션 등 **비 원자적인 애트리뷰트를 허용하지 않는 릴레이션**의 형태다.<br>

<br>



### 제 2 정규형 (x → y)

함수적 종속관계를 파악해 분류한 릴레이션.



> 아래 내용은 수정필요(soon.good 리포지터리 백업 확인 후 인프런 강의 내용 필기를 참조해 수정 필요)

모든 **비 주요 애트리뷰트들이 주요 애트리뷰트에 대해 완전 함수적 종속** 이면 제 2 정규형을 만족한다.<br>

키가 아닌 열들이 각각 후보키에 의해 결정되는 릴레이션의 형태를 의미한다.<br>

<br>



**완전함수적 종속?**<br>

**x → y 라고 가정했을 때, x의 어떤 애트리뷰트라도 제거하면 더 이상 함수적 종속성이 성립하지 않는 경우**를 의미한다.<br>

<Br>



### 제 3 정규형 (x → y, y → z = x → z), "이행종속"

어떠한 비 주요 애트리뷰트도 <u>기본키에 대해 이행적으로 종속</u>되어야 한다.

만약 이행적으로 종속되지 않으면 제 3 정규형을 만족한다고 볼 수 없다.



> 아래 내용은 수정필요(soon.good 리포지터리 백업 확인 후 인프런 강의 내용 필기를 참조해 수정 필요)

비주요 애트리뷰트가 비주요 애트리뷰트에 의해 종속되는 경우가 없는 릴레이션 형태를 의미한다.

**이행 함수적 종속?**<br>

 x->y, y->z 의 경우에 의해 추론될 수 있는 x->z 의 종속관계를 의미한다.<br>

<br>



### BCNF (Boyce-Codd) 정규형

> 아래 내용은 수정필요(soon.good 리포지터리 백업 확인 후 인프런 강의 내용 필기를 참조해 수정 필요)

여러 후보키가 존재하는 릴레이션에 해당하는 정규화<br>

복잡한 식별자 관계에 의해 발생하는 문제를 해결하기위해, 제 3정규형을 보완하는 데에 의미가 있다.<br>

비주요 애트리뷰트가 후보키의 일부를 결정하는 분해는 과정을 의미한다.<br>

<br>





### 정규화의 장점

**데이터의 중복을 없애서 갱신 이상 현상을 방지한다.**<br>

- 삽입 이상
- 삭제 이상
- 수정 이상



<br>

**데이터베이스 구조 확장시 재 디자인 최소화**<br>

정규화된 데이터베이스 구조는 새로운 데이터 형의 추가로 인한 확장 시 구조 변경의 가능성이 많이 줄어들거나 변경을 하지 않아도 된다.

이것은 데이터베이스와 연동된 응용프로그램에 최소한의 영향만 미치게 되며 응용프로그램의 생명을 연장시킨다.

<br>



**사용자에게 데이터 모델을 의미있게 제공**<br>

정규화된 테이블 들과 정규화된 테이블 들 간의 관계 들은 현실 세계에서의 개념 들과 그 들 간의 관계들을 반영한다.<br>

<br>



### 정규화의 단점

릴레이션의 분해로 인해 릴레이션 간의 연산(JOIN 연산)이 많아진다. 이로 인해 질의에 대한 응답 시간이 느려질 수 있다.<br>

정규화를 수행한다는 것은 데이터를 결정하는 <u>결정자에 의해 함수적 종속을 가지고 있는 일반 속성을 의존자를 통해 입력/수정/삭제 이상을 제거하는 것</u>이다. 데이터의 중복 속성을 제거하고 결정자에 의해 동일한 의미의 일반 속성이 하나의 테이블로 집약되기에 한 테이블의 데이터 용량이 최소화 되는 효과가 있다.<br>

따라서 정규화 된 테이블은 데이터를 처리할 때 속도가 빨라질 수도 있고 느려질 수 도 있는 특성이 있다.<br>

<br>



### 반정규화 대신 선택할 수 있는 방안

- Redis 등과 같은 캐시 기반에서 자료구조를 통한 해결
- MongoDB 등의 NoSQL 기반의 매개체 서비스 도입

<br>



### 정규화의 단점을 고려했을때, 어떤 상황에서 반정규화를 진행해야 할까?

조회를 하는 SQL 문장에서 조인이 많이 발생해서 이것으로 인한 성능 저하가 발생하다면 반정규화를 하는 전략이 필요하다.<br>

<br>



### 반정규화 (De-Normalization, 비정규화)

반정규화는 정규화된 엔티티,속성 관계를 시스템의 성능향상, 개발, 운영의 단순화를 위해 중복통합, 분리 등을 수행하는 데이터 모델링 기법 중의 하나다.<br>

반정규화를 수행하게끔 하는 주요 사례들은 아래와 같다.

- 디스크 I/O 양이 많아져서 조회시 성능이 저하
- 테이블 끼리의 경로가 너무 멀어서 조인으로 인한 성능 저하 예상
- 컬럼을 계산해 조회할 때 성능이 저하될 것이 예상될 때

<br>



일반적으로 조회에 대한 처리 성능이 중요하다고 판단될 때 부분적으로 반정규화를 고려하게 된다.<br>

<br>



