### Spring Data. 영속성 컨텍스트, 엔티티의 4가지 상태



### 영속성 컨텍스트 와 EntityManager

영속성 컨텍스트라는 것은 엔티티를 관리하는 하나의 컨테이너를 의미한다. 

엔티티 매니저는 엔티티가 변경되었는지 변경감지를 해서 이것을 트랜잭션이 종료될때 커밋을 하는 등의 동작을 하도록 하는 역할을 한다.



즉, 영속성 컨텍스트 내의 엔티티가 변경되었는지 변경을 감지해서 트랜잭션 종료시 플러시 등의 동작을 수행하는 역할을 수행하는 것이 엔티티 매니저다.

<br>



### Entity 의 4 가지 상태

영속성 컨텍스트는 아래의 4가지 상태로 분류될 수 있다.

- 생성 (New)
  - 프로그램 상에서 엔티티 객체는 생성했지만, 영속성 컨테이너(엔티티 매니저)에 등록하지는 않은 상태
- 관리 (Managed)
  - 영속성 컨테이너에 엔티티를 등록한 상태
  - EntityManager 내의 persist(), find() 를 호출했을 때
- 분리 (Detached)
  - 영속성 컨테이너에서 엔티티를 분리한 상태
  - EntityManager 내의 detach(E), clear(), close() 를 호출할 때
  - datach(E) : 특정 엔티티만 분리상태로 전환
  - clear() : 영속 컨테이너가 관리하는 모든 엔티티들을 Detached 로 전환
  - close() : 영속 컨테이너를 종료. 영속성 컨테이너가 가지고 있는 자원들(객체, 커넥션, 트랜잭션)을 반환하고, Entity 들 역시 모두 분리 상태로 전환
- 삭제 (Removed)
  - 영속성 컨테이너에서 엔티티를 삭제 처리한 상태
  - EntityManager 의 remove(E)를 호출할 때 







