### 계층별 테스트

Spring 쪽의 이야기를 해보면 계층별 테스트는 보통 아래와 같이 수행한다.

Controller

- 파라미터 바인딩, 밸리데이션
  - e.g. password 는 알파벳 소문자, 대문자를 구별하며, 숫자는 두 글자 포함되어야 하고 특수문자를 한 글자 이상 포함해야 한다.
  - e.g. 상품 코드는 null 일 수 없다.
- 파라미터 바인딩, 벨리데이션이 틀릴 경우 예외가 적정한지를 테스트
  - e.g. page 번호가 음수일 경우 IllegalPageNumberException 을 낸다.
- Service 계층의 예외를 가정했을 때 RestControllerAdvice 를 통해 올바른 예외를 내는지를 가정
- 계속해서 추가



Service

- Repository 에 데이터를 저장할 때 트랜잭션 상에 예외가 있을 경우에 대한 처리
- 다른 컴포넌트의 어떤 메서드를 



Repository

- Profile 을 통해 Datasource 를 주입받아서 테스트
- 주로 h2 로 먼저 테스트를 수행한다. 그리고 나서 개발 DB에서도 정상적인지를 테스트한다.
- 예전에는 mybatis 는 h2 테스트가 쉽지 않았는데, 요즘은 너무 오래된 mybatis 버전이 아닌 이상 h2 를 데이터소스로 지정해서 테스트하는 것이 가능해짐
- Repository 에서 예외를 발생시키거나 데이터를 변환하고 이런 작업을 하면 어떤 계층에서 예외가 발생했는지 찾기 어려워지는 현상이 발생한다.
- 이런 경우 Service 계층에 팩토리 메서드 또는 Mapper 클래스 등을 별도로 두어서 데이터 계층의 엔티티를 Service 계층에 전달하는 DTO 를 만드는 역할의 메서드들을 따로 구현해둔다.