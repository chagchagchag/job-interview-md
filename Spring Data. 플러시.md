### 플러시

플러시 실행시 엔티티 매니저는 모든 엔티티의 상태를 체크 후 SQL 을 생성한다.

캐시에 저장된 엔티티의 상태 변화를 데이터베이스에 반영하는 동기화 과정이 수행된다. 

캐시 플러시가 수행되는 경우는 3가지 경우다.

명시적 플러시

- 1\) entityManager.flush() 같은 메서드로 명시적으로 플러시 수행

묵시적 플러시

- 2\) transaction.commit() 실행시
  - 트랜잭션이 커밋될때.
- 3\) JPQL 을 이용해 쿼리를 실행시
  - JPQL로 select 쿼리를 실행할 때 영속성 컨테이너(=엔티티 매니저)는 쿼리를 전송하기 직전에 엔티티 캐시에 대한 플러시를 수행한다.

<br>



### 플러시 실행시 엔티티 매니저가 수행하는 동작

관리 상태

- persist 메서드로 관리 상태를 만든 경우 insert 연산 수행
- 값이 변경된 경우 더티체킹을 통해 트랜잭션 종료시 update 수행

삭제 상태

- remove 메서드로 삭제 상태 만든 경우 delete 연산 수행

<br>



### 플러시 모드 설정

> 플러시 모드를 코드로 직접 변경하는 경우는 없긴 하지만 정리.

플러시모드를 변경하는 것은 EntityManager.setFlushMode() 메서드로 변경가능하며, 설정할 수 있는 플러시 모드는 아래의 두가지다.<br>

<br>



FlushModeType.AUTO

- EntityManager 의 기본 설정에서 플러시 모드 타입은 FlushModeType.AUTO 다.

FlushModeType.COMMIT

- 트랜잭션이 커밋될 때에만 플러시가 동작
- JPQL 이 실행될 때에는 플러시가 동작하지 않는다.

<br>



### 더티체킹

영속성 컨테이너에 존재하는 엔티티가 변경된다면 영속성 컨텍스트는 엔티티의 값 변화를 감지해서 데이터베이스에 변경사항을 반영한다. 이렇게 엔티티의 값이 변화되었는지를 체크하는 동작을 더티체킹이라고 한다.

<br>

